---
import { Image } from "@astrojs/image/components";
import { AdvancedImage } from "@cloudinary/react";
import { Cloudinary } from "@cloudinary/url-gen";
import { format, quality } from "@cloudinary/url-gen/actions/delivery";
import { fill } from "@cloudinary/url-gen/actions/resize";
import { auto as f_auto } from "@cloudinary/url-gen/qualifiers/format";
import { autoGravity } from "@cloudinary/url-gen/qualifiers/gravity";
import { auto as q_auto } from "@cloudinary/url-gen/qualifiers/quality";
import type { AspectRatioType } from "@cloudinary/url-gen/types/types";
import type React from "react";

interface Props extends React.ImgHTMLAttributes<HTMLImageElement> {
  src: string; /// cloudinary publicID
  alt: string;
  width: number;
  aspectRatio: `${number}:${number}` | number;
}

const { src, alt, width, aspectRatio } = Astro.props;

const cld = new Cloudinary({
  cloud: {
    cloudName: import.meta.env.CLOUDINARY_CLOUD_NAME,
  },
});

const image = cld
  .image(src)
  .resize(fill().width(width).aspectRatio(aspectRatio).gravity(autoGravity()))
  .delivery(quality(q_auto()))
  .delivery(format(f_auto()));
---

<AdvancedImage cldImg={image} alt={alt} />

<!-- <img src={image} alt={alt} loading="lazy" {...props} /> -->
<!-- <Image
  src={image}
  alt={alt}
  width={width}
  height={height}
  loading="lazy"
  fit="cover"
  position="entropy"
/> -->
