---
import { CollectionEntry, getCollection } from "astro:content";
import PostImage from "src/components/PostImage.astro";
import PostPreview from "src/components/PostPreview.astro";
import TagList from "src/components/TagList.astro";
import MainLayout from "src/layouts/MainLayout.astro";
import S3Image from "src/components/S3Image.astro";
import ColumnLayout from "src/layouts/ColumnLayout.astro";
import GutterLayout from "src/layouts/GutterLayout.astro";
import { number } from "astro/zod";
import LatestPosts from "src/components/LatestPosts.astro";

export async function getStaticPaths() {
  const guideEntries = await getCollection("guides");

  return guideEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<"guides">;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const { title, description, subtitle, image, tags, pubDate, author } =
  entry.data;

const allGuides = await getCollection("guides");
---

<MainLayout>
  <article>
    <GutterLayout>
      <header class="my-14">
        <ColumnLayout class="lg:items-end gap-y-4 lg:gap-y-0">
          <div>
            <h1 class="text-5xl max-w-2xl">
              <span class="font-bold tracking-tight"> {title}</span>
              <span class="font-serif italic">{subtitle}</span>
            </h1>
            <div class="mt-5">
              <TagList tags={tags} />
            </div>
          </div>
          <p class="text-lg text-neutral-600">
            {description}
          </p>
        </ColumnLayout>
      </header>

      <ColumnLayout>
        <div>
          <div class="aspect-w-3 aspect-h-2 w-full">
            <S3Image
              src={image.src}
              alt={image.alt}
              width={800}
              aspectRatio={3 / 2}
            />
          </div>
          <div class="flex justify-end space-x-6">
            <div class="mt-2 text-sm uppercase tracking-wide text-neutral-500">
              {author} // {
                pubDate.toLocaleDateString("en-us", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })
              }
            </div>
          </div>
          <div
            class="prose prose-lg prose-neutral max-w-none prose-headings:tracking-tight prose-p:leading-8 sm:prose-xl"
          >
            <div class="mx-auto max-w-xl">
              <Content components={{ img: PostImage }} />
            </div>
          </div>
        </div>
        <div class="relative hidden lg:block">
          <aside class="sticky top-20">
            <!-- an ad can go here -->
            <!-- <div class="h-[500px] w-full bg-neutral-100"></div> -->

            <div
              class="mb-4 text-sm uppercase tracking-wide text-neutral-500"
            >
              Latest Posts
            </div>
            <LatestPosts />
          </aside>
        </div>
      </ColumnLayout>

      <div
        class="mt-20 mb-8 grid grid-cols-1 gap-x-8 gap-y-10 border-t-2 border-neutral-800 sm:grid-cols-2 lg:grid-cols-3"
      >
        <div class="col-span-full">
          <h2 class="mt-4 text-left text-2xl font-bold tracking-tight">
            You might also like
          </h2>
        </div>
        {
          allGuides.map((guide) => (
            <PostPreview guide={guide} />
          ))
        }
      </div>
    </GutterLayout>
  </article>
</MainLayout>
